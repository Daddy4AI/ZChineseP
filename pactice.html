<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Practice</title>
</head>
<body>
    <h1>Practice</h1>
    <p id="progress"></p>
    <button onclick="repeatWord()">Repeat</button>
    <button onclick="nextWord()">Next</button>

    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-database.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAoyZelymQJvY13J6SVph46E0UcajCRubw",
            authDomain: "chineselists.firebaseapp.com",
            databaseURL: "https://chineselists-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "chineselists",
            storageBucket: "chineselists.appspot.com",
            messagingSenderId: "149825999355",
            appId: "1:149825999355:web:f1478a5e019df1b21bbb5e",
            measurementId: "G-V7B3T8GG34"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let words = [];
        let currentIndex = 0;

        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const listId = urlParams.get('listId');
            const category = urlParams.get('category');
            const sortOrder = urlParams.get('sortOrder');

            database.ref('Words').orderByChild('list_id').equalTo(listId).once('value', snapshot => {
                snapshot.forEach(childSnapshot => {
                    const word = childSnapshot.val();
                    if (category === 'all' || word.category_id === category) {
                        words.push(word.word_text);
                    }
                });

                if (sortOrder === 'random') {
                    words = words.sort(() => Math.random() - 0.5);
                }

                playWord();
            });
        };

        function playWord() {
            if (currentIndex < words.length) {
                const word = words[currentIndex];
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'zh-Hant'; // 繁體中文語音合成
                speechSynthesis.speak(utterance);

                document.getElementById('progress').textContent = `Now: ${currentIndex + 1}/${words.length}`;
            }
        }

        function repeatWord() {
            playWord();
        }

        function nextWord() {
            if (currentIndex < words.length - 1) {
                currentIndex++;
                playWord();
            } else {
                alert('You have finished the practice!');
            }
        }
    </script>
</body>
</html>
